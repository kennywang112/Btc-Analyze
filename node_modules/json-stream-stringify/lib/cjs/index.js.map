{"version":3,"file":"index.js","sources":["../../src/JsonStreamStringify.ts"],"sourcesContent":["/* eslint-disable max-classes-per-file */\nimport { Readable } from 'stream';\n\n// eslint-disable-next-line no-control-regex, no-misleading-character-class\nconst rxEscapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n\n// table of character substitutions\nconst meta = {\n  '\\b': '\\\\b',\n  '\\t': '\\\\t',\n  '\\n': '\\\\n',\n  '\\f': '\\\\f',\n  '\\r': '\\\\r',\n  '\"': '\\\\\"',\n  '\\\\': '\\\\\\\\',\n};\n\nfunction isReadableStream(value): boolean {\n  return typeof value.read === 'function'\n      && typeof value.pause === 'function'\n      && typeof value.resume === 'function'\n      && typeof value.pipe === 'function'\n      && typeof value.once === 'function'\n      && typeof value.removeListener === 'function';\n}\n\nenum Types {\n  Array,\n  Object,\n  ReadableString,\n  ReadableObject,\n  Primitive,\n  Promise,\n}\n\nfunction getType(value): Types {\n  if (!value) return Types.Primitive;\n  if (typeof value.then === 'function') return Types.Promise;\n  if (isReadableStream(value)) return value._readableState.objectMode ? Types.ReadableObject : Types.ReadableString;\n  if (Array.isArray(value)) return Types.Array;\n  if (typeof value === 'object' || value instanceof Object) return Types.Object;\n  return Types.Primitive;\n}\n\nconst stackItemOpen = [];\nstackItemOpen[Types.Array] = '[';\nstackItemOpen[Types.Object] = '{';\nstackItemOpen[Types.ReadableString] = '\"';\nstackItemOpen[Types.ReadableObject] = '[';\n\nconst stackItemEnd = [];\nstackItemEnd[Types.Array] = ']';\nstackItemEnd[Types.Object] = '}';\nstackItemEnd[Types.ReadableString] = '\"';\nstackItemEnd[Types.ReadableObject] = ']';\n\nfunction escapeString(string) {\n  // Modified code, original code by Douglas Crockford\n  // Original: https://github.com/douglascrockford/JSON-js/blob/master/json2.js\n\n  // If the string contains no control characters, no quote characters, and no\n  // backslash characters, then we can safely slap some quotes around it.\n  // Otherwise we must also replace the offending characters with safe escape\n  // sequences.\n\n  return string.replace(rxEscapable, (a) => {\n    const c = meta[a];\n    return typeof c === 'string' ? c : `\\\\u${a.charCodeAt(0).toString(16).padStart(4, '0')}`;\n  });\n}\n\nlet primitiveToJSON: (value: any) => string;\n\nif (global?.JSON?.stringify instanceof Function) {\n  let canSerializeBigInt = true;\n  try {\n    if (JSON.stringify(global.BigInt ? global.BigInt('123') : '') !== '123') throw new Error();\n  } catch (err) {\n    canSerializeBigInt = false;\n  }\n  if (canSerializeBigInt) {\n    primitiveToJSON = JSON.parse;\n  } else {\n    // eslint-disable-next-line no-confusing-arrow\n    primitiveToJSON = (value) => typeof value === 'bigint' ? String(value) : JSON.stringify(value);\n  }\n} else {\n  primitiveToJSON = (value) => {\n    switch (typeof value) {\n      case 'string':\n        return `\"${escapeString(value)}\"`;\n      case 'number':\n        return Number.isFinite(value) ? String(value) : 'null';\n      case 'bigint':\n        return String(value);\n      case 'boolean':\n        return value ? 'true' : 'false';\n      case 'object':\n        if (!value) {\n          return 'null';\n        }\n      // eslint-disable-next-line no-fallthrough\n      default:\n        // This should never happen, I can't imagine a situation where this executes.\n        // If you find a way, please open a ticket or PR\n        throw Object.assign(new Error(`Not a primitive \"${typeof value}\".`), { value });\n    }\n  };\n}\n\n/*\nfunction quoteString(string: string) {\n  return primitiveToJSON(String(string));\n}\n*/\n\nconst cache = new Map();\nfunction quoteString(string: string) {\n  const useCache = string.length < 10_000;\n  // eslint-disable-next-line no-lonely-if\n  if (useCache && cache.has(string)) {\n    return cache.get(string);\n  }\n  const str = primitiveToJSON(String(string));\n  if (useCache) cache.set(string, str);\n  return str;\n}\n\nfunction readAsPromised(stream, size) {\n  const value = stream.read(size);\n  if (value === null) {\n    return new Promise((resolve, reject) => {\n      const endListener = () => resolve(null);\n      stream.once('end', endListener);\n      stream.once('error', reject);\n      stream.once('readable', () => {\n        stream.removeListener('end', endListener);\n        stream.removeListener('error', reject);\n        resolve(stream.read());\n      });\n    });\n  }\n  return Promise.resolve(value);\n}\n\ninterface Item {\n  read(size?: number): Promise<void> | void;\n  depth?: number;\n  value?: any;\n  indent?: string;\n  path?: (string | number)[];\n}\n\nenum ReadState {\n  NotReading = 0,\n  Reading,\n  ReadMore,\n  Consumed,\n}\n\nexport class JsonStreamStringify extends Readable {\n  item?: Item;\n  indent?: string;\n  root: Item;\n  include: string[];\n  replacer: Function;\n  visited: [] | WeakMap<any, string[]>;\n\n  constructor(\n    input: any,\n    replacer?: Function | any[] | undefined,\n    spaces?: number | string | undefined,\n    private cycle = false,\n    private bufferSize = 512,\n  ) {\n    super({ encoding: 'utf8' });\n\n    const spaceType = typeof spaces;\n    if (spaceType === 'number') {\n      this.indent = ' '.repeat(<number>spaces);\n    } else if (spaceType === 'string') {\n      this.indent = <string>spaces;\n    }\n\n    const replacerType = typeof replacer;\n    if (replacerType === 'object') {\n      this.include = replacer as string[];\n    } else if (replacerType === 'function') {\n      this.replacer = replacer as Function;\n    }\n\n    this.visited = cycle ? new WeakMap() : [];\n\n    this.root = <any>{\n      value: { '': input },\n      depth: 0,\n      indent: '',\n      path: [],\n    };\n    this.setItem(input, this.root, '');\n  }\n\n  setItem(value, parent: Item, key: string | number = '') {\n    // call toJSON where applicable\n    if (\n      value\n      && typeof value === 'object'\n      && typeof value.toJSON === 'function'\n    ) {\n      value = value.toJSON(key);\n    }\n\n    // use replacer if applicable\n    if (this.replacer) {\n      value = this.replacer.call(parent.value, key, value);\n    }\n\n    // coerece functions and symbols into undefined\n    if (value instanceof Function || typeof value === 'symbol') {\n      value = undefined;\n    }\n\n    const type = getType(value);\n    let path;\n\n    // check for circular structure\n    if (!this.cycle && type !== Types.Primitive) {\n      if ((this.visited as any[]).some((v) => v === value)) {\n        this.destroy(Object.assign(new Error('Converting circular structure to JSON'), {\n          value,\n          key,\n        }));\n        return;\n      }\n      (this.visited as any[]).push(value);\n    } else if (this.cycle && type !== Types.Primitive) {\n      path = (this.visited as WeakMap<any, string[]>).get(value);\n      if (path) {\n        this._push(`{\"$ref\":\"$${path.map((v) => `[${(Number.isInteger(v as number) ? v : escapeString(quoteString(v as string)))}]`).join('')}\"}`);\n        this.item = parent;\n        return;\n      }\n      path = parent === this.root ? [] : parent.path.concat(key);\n      (this.visited as WeakMap<any, string[]>).set(value, path);\n    }\n\n    if (type === Types.Object) {\n      this.setObjectItem(value, parent);\n    } else if (type === Types.Array) {\n      this.setArrayItem(value, parent);\n    } else if (type === Types.Primitive) {\n      if (parent !== this.root && typeof key === 'string') {\n        // (<any>parent).write(key, primitiveToJSON(value));\n        if (value === undefined) {\n          // clear prePush buffer\n          // this.prePush = '';\n        } else {\n          this._push(primitiveToJSON(value));\n        }\n        // undefined values in objects should be rejected\n      } else if (value === undefined && typeof key === 'number') {\n        // undefined values in array should be null\n        this._push('null');\n      } else if (value === undefined) {\n        // undefined values should be ignored\n      } else {\n        this._push(primitiveToJSON(value));\n      }\n      this.item = parent;\n      return;\n    } else if (type === Types.Promise) {\n      this.setPromiseItem(value, parent, key);\n    } else if (type === Types.ReadableString) {\n      this.setReadableStringItem(value, parent);\n    } else if (type === Types.ReadableObject) {\n      this.setReadableObjectItem(value, parent);\n    }\n\n    this.item.value = value;\n    this.item.depth = parent.depth + 1;\n    if (this.indent) this.item.indent = this.indent.repeat(this.item.depth);\n    this.item.path = path;\n  }\n\n  setReadableStringItem(input: Readable, parent: Item) {\n    if (input.readableEnded || (input as any)._readableState?.endEmitted) {\n      this.emit('error', new Error('Readable Stream has ended before it was serialized. All stream data have been lost'), input, parent.path);\n    } else if (input.readableFlowing || (input as any)._readableState?.flowing) {\n      input.pause();\n      this.emit('error', new Error('Readable Stream is in flowing mode, data may have been lost. Trying to pause stream.'), input, parent.path);\n    }\n    const that = this;\n    this._push('\"');\n    input.once('end', () => {\n      this._push('\"');\n      this.item = parent;\n      this.emit('readable');\n    });\n    this.item = <any>{\n      type: 'readable string',\n      async read(size: number) {\n        try {\n          const data = await readAsPromised(input, size);\n          if (data) that._push(escapeString(data.toString()));\n        } catch (err) {\n          that.emit('error', err);\n          that.destroy();\n        }\n      },\n    };\n  }\n\n  setReadableObjectItem(input: Readable, parent: Item) {\n    if (input.readableEnded || (input as any)._readableState?.endEmitted) {\n      this.emit('error', new Error('Readable Stream has ended before it was serialized. All stream data have been lost'), input, parent.path);\n    } else if (input.readableFlowing || (input as any)._readableState?.flowing) {\n      input.pause();\n      this.emit('error', new Error('Readable Stream is in flowing mode, data may have been lost. Trying to pause stream.'), input, parent.path);\n    }\n    const that = this;\n    this._push('[');\n    let first = true;\n    let i = 0;\n    const item = <any>{\n      type: 'readable object',\n      async read(size: number) {\n        try {\n          let out = '';\n          const data = await readAsPromised(input, size);\n          if (data === null) {\n            if (i && that.indent) {\n              out += `\\n${parent.indent}`;\n            }\n            out += ']';\n            that._push(out);\n            that.item = parent;\n            that.unvisit(input);\n            return;\n          }\n          if (first) first = false;\n          else out += ',';\n          if (that.indent) out += `\\n${item.indent}`;\n          that._push(out);\n          that.setItem(data, item, i);\n          i += 1;\n        } catch (err) {\n          that.emit('error', err);\n          that.destroy();\n        }\n      },\n    };\n    this.item = item;\n  }\n\n  setPromiseItem(input: Promise<any>, parent: Item, key) {\n    const that = this;\n    let read = false;\n    this.item = {\n      async read() {\n        if (read) return;\n        read = true;\n        input.then((v) => that.setItem(v, parent, key), (err) => {\n          that.emit('error', err);\n          that.destroy();\n        });\n      },\n    };\n  }\n\n  setArrayItem(input: any[], parent: any) {\n    // const entries = input.slice().reverse();\n    let i = 0;\n    const len = input.length;\n    let first = true;\n    const that = this;\n    const item: Item = {\n      read() {\n        let out = '';\n        let wasFirst = false;\n        if (first) {\n          first = false;\n          wasFirst = true;\n          if (!len) {\n            that._push('[]');\n            that.unvisit(input);\n            that.item = parent;\n            return;\n          }\n          out += '[';\n        }\n        const entry = input[i];\n        if (i === len) {\n          if (that.indent) out += `\\n${parent.indent}`;\n          out += ']';\n          that._push(out);\n          that.item = parent;\n          that.unvisit(input);\n          return;\n        }\n        if (!wasFirst) out += ',';\n        if (that.indent) out += `\\n${item.indent}`;\n        that._push(out);\n        that.setItem(entry, item, i);\n        i += 1;\n      },\n    };\n    this.item = item;\n  }\n\n  unvisit(item) {\n    if (this.cycle) return;\n    const _i = (this.visited as any[]).indexOf(item);\n    if (_i > -1) (this.visited as any[]).splice(_i, 1);\n  }\n\n  objectItem?: any;\n  setObjectItem(input: Record<any, any>, parent = undefined) {\n    const keys = Object.keys(input);\n    let i = 0;\n    const len = keys.length;\n    let first = true;\n    const that = this;\n    const { include } = this;\n    let hasItems = false;\n    let key;\n    const item: Item = <any>{\n      read() {\n        if (i === 0) that._push('{');\n        if (i === len) {\n          that.objectItem = undefined;\n          if (!hasItems) {\n            that._push('}');\n          } else {\n            that._push(`${that.indent ? `\\n${parent.indent}` : ''}}`);\n          }\n          that.item = parent;\n          that.unvisit(input);\n          return;\n        }\n        key = keys[i];\n        if (include?.indexOf?.(key) === -1) {\n          // replacer array excludes this key\n          i += 1;\n          return;\n        }\n        that.objectItem = item;\n        i += 1;\n        that.setItem(input[key], item, key);\n      },\n      write() {\n        const out = `${hasItems && !first ? ',' : ''}${item.indent ? `\\n${item.indent}` : ''}${quoteString(key)}:${that.indent ? ' ' : ''}`;\n        first = false;\n        hasItems = true;\n        that.objectItem = undefined;\n        return out;\n      },\n    };\n    this.item = item;\n  }\n\n  prePush?: Function = undefined;\n  buffer = '';\n  bufferLength = 0;\n  pushCalled = false;\n\n  readSize = 0;\n  private _push(data) {\n    this.buffer += (this.objectItem ? this.objectItem.write() : '') + data;\n    this.prePush = undefined;\n    if (this.buffer.length >= this.bufferSize) {\n      this.pushCalled = !this.push(this.buffer);\n      this.buffer = '';\n      this.bufferLength = 0;\n      return false;\n    }\n    return true;\n  }\n\n  reading = false;\n  readMore = false;\n  readState: ReadState = ReadState.NotReading;\n  async _read(size?: number) {\n    if (this.readState !== ReadState.NotReading) {\n      this.readState = ReadState.ReadMore;\n      return;\n    }\n    this.readState = ReadState.Reading;\n    this.pushCalled = false;\n    let p;\n    while (!this.pushCalled && this.item !== this.root && !this.destroyed) {\n      p = this.item.read(size);\n      // eslint-disable-next-line no-await-in-loop\n      if (p) await p;\n    }\n    if (this.item === this.root) {\n      if (this.buffer.length) this.push(this.buffer);\n      this.push(null);\n      this.readState = ReadState.Consumed;\n      this._destroy();\n    }\n    if (this.readState === <any>ReadState.ReadMore) {\n      this.readState = ReadState.NotReading;\n      this._read(size);\n    }\n    this.readState = ReadState.NotReading;\n  }\n\n  _destroy() {\n    this.destroyed = true;\n    this.buffer = undefined;\n    this.visited = undefined;\n    this.item = undefined;\n    this.prePush = undefined;\n  }\n\n  destroy(error?: Error): this {\n    if (error) this.emit('error', error);\n    super.destroy?.();\n    this._destroy();\n    return this;\n  }\n}\n"],"names":["rxEscapable","meta","isReadableStream","value","read","pause","resume","pipe","once","removeListener","Types","getType","Primitive","then","Promise","_readableState","objectMode","ReadableObject","ReadableString","Array","isArray","Object","stackItemOpen","stackItemEnd","escapeString","string","replace","a","c","charCodeAt","toString","padStart","primitiveToJSON","global","JSON","stringify","Function","canSerializeBigInt","BigInt","Error","err","parse","String","Number","isFinite","assign","cache","Map","quoteString","useCache","length","has","get","str","set","readAsPromised","stream","size","resolve","reject","endListener","ReadState","JsonStreamStringify","Readable","constructor","input","replacer","spaces","cycle","bufferSize","encoding","undefined","NotReading","spaceType","indent","repeat","replacerType","include","visited","WeakMap","root","depth","path","setItem","parent","key","toJSON","call","type","some","v","destroy","push","_push","map","isInteger","join","item","concat","setObjectItem","setArrayItem","setPromiseItem","setReadableStringItem","setReadableObjectItem","readableEnded","endEmitted","emit","readableFlowing","flowing","that","data","first","i","out","unvisit","len","wasFirst","entry","_i","indexOf","splice","keys","hasItems","objectItem","write","buffer","prePush","pushCalled","bufferLength","_read","readState","ReadMore","Reading","p","destroyed","Consumed","_destroy","error"],"mappings":"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"}